---
title: 虚拟内存概念
categories: Develop
tags:
  - Linux
  - 操作系统
  - 内核
  - 内存
  - 进程
---

## 进程的虚拟内存

虚拟内存空间存储着进程需要用到的各种数据和指令。所以虚拟内存空间是为进程而设计的一种抽象内存概念，每个进程都有自己的虚拟内存空间，仿佛自己在独占电脑的物理内存一样。

GCC对源码进行编译时，给编译后的程序分配的便是虚拟空间，编译时程序并为运行，就没有映射物理地址。

在32位操作系统下最物理内存大寻址空间为4G，所以每个进程虚拟内存空间也最大为4G。这里要注意，一个进程的虚拟内存空间占用大小不代表实际运行占有物理内存空间大小（想想也知道阿，如果虚拟内存空间==实际上占用空间，那么运行2个进程岂不是要8G，4个就需要16G？不存在的...）。


虚拟内存的概念是操作系统安全构成重要的一部分。如：当一个程序指针读写出错，其造成的文件读写错误限制在其虚拟内存那一小块区域里，不影响其他正常的进程。

## 虚拟内存页（Pages）

内核通过页映射表（page table）来把虚拟内存映射（按需映射）到物理内存上，虚拟内存页和可用物理内存页是一一对应关系。

单个页表分为俩部分，第一部分记录该页是否被映射至物理内存页，第二部分记录该页在物理内存页上的位置。进程通过页表映射关系，进而知道虚拟内存页中哪些数据已被映射至物理内存页，以及映射的位置。

内核为每个进程都维护了一份页映射表。页是虚拟内存与物理内存映射的基本单位。默认页大小为4K

**按需映射**:每个进程只把自己目前需要的虚拟内存空间那块数据映射并存储到物理内存上。

- 缺页异常（缺页中断）

进程访问的地址是合法的，但是该地址还未分配物理内存页
如果一个进程需要通过虚拟内存页映射新的数据至物理内存页， 则由MMU引发缺页异常。




